<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx를 이용해 SpringBoot Application을 80 port로 프록시 | Today kiyeoneee Learned</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="What kiyeoneee learned everyday">
    <link rel="preload" href="/TIL/assets/css/0.styles.25cf7e1a.css" as="style"><link rel="preload" href="/TIL/assets/js/app.36d7193a.js" as="script"><link rel="preload" href="/TIL/assets/js/2.58d7ab3e.js" as="script"><link rel="preload" href="/TIL/assets/js/41.af98162f.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.048fb2ed.js"><link rel="prefetch" href="/TIL/assets/js/11.05acbce4.js"><link rel="prefetch" href="/TIL/assets/js/12.2d05dddd.js"><link rel="prefetch" href="/TIL/assets/js/13.af44783c.js"><link rel="prefetch" href="/TIL/assets/js/14.d1045c81.js"><link rel="prefetch" href="/TIL/assets/js/15.2f23ca42.js"><link rel="prefetch" href="/TIL/assets/js/16.0a744b02.js"><link rel="prefetch" href="/TIL/assets/js/17.47340957.js"><link rel="prefetch" href="/TIL/assets/js/18.39e0475b.js"><link rel="prefetch" href="/TIL/assets/js/19.e1dc3414.js"><link rel="prefetch" href="/TIL/assets/js/20.0839137b.js"><link rel="prefetch" href="/TIL/assets/js/21.8666cc16.js"><link rel="prefetch" href="/TIL/assets/js/22.682ec01c.js"><link rel="prefetch" href="/TIL/assets/js/23.cdb5f9b7.js"><link rel="prefetch" href="/TIL/assets/js/24.7f21ead0.js"><link rel="prefetch" href="/TIL/assets/js/25.6773f05f.js"><link rel="prefetch" href="/TIL/assets/js/26.9962604c.js"><link rel="prefetch" href="/TIL/assets/js/27.69f50687.js"><link rel="prefetch" href="/TIL/assets/js/28.29ff5a60.js"><link rel="prefetch" href="/TIL/assets/js/29.d236ae5b.js"><link rel="prefetch" href="/TIL/assets/js/3.65ec9f17.js"><link rel="prefetch" href="/TIL/assets/js/30.f61903f7.js"><link rel="prefetch" href="/TIL/assets/js/31.fbba2a41.js"><link rel="prefetch" href="/TIL/assets/js/32.09552d2e.js"><link rel="prefetch" href="/TIL/assets/js/33.74f8ec54.js"><link rel="prefetch" href="/TIL/assets/js/34.4da81b7b.js"><link rel="prefetch" href="/TIL/assets/js/35.d86a1d32.js"><link rel="prefetch" href="/TIL/assets/js/36.687966b0.js"><link rel="prefetch" href="/TIL/assets/js/37.e5acbc63.js"><link rel="prefetch" href="/TIL/assets/js/38.5878af28.js"><link rel="prefetch" href="/TIL/assets/js/39.5a33282c.js"><link rel="prefetch" href="/TIL/assets/js/4.3b787219.js"><link rel="prefetch" href="/TIL/assets/js/40.cf01aa7d.js"><link rel="prefetch" href="/TIL/assets/js/42.0d5739b3.js"><link rel="prefetch" href="/TIL/assets/js/43.f18c6fee.js"><link rel="prefetch" href="/TIL/assets/js/44.dcfa370f.js"><link rel="prefetch" href="/TIL/assets/js/45.f705dec9.js"><link rel="prefetch" href="/TIL/assets/js/46.14c5ffab.js"><link rel="prefetch" href="/TIL/assets/js/47.763a0c6d.js"><link rel="prefetch" href="/TIL/assets/js/48.e6751300.js"><link rel="prefetch" href="/TIL/assets/js/49.685f8dae.js"><link rel="prefetch" href="/TIL/assets/js/5.7223da21.js"><link rel="prefetch" href="/TIL/assets/js/6.842ad9b8.js"><link rel="prefetch" href="/TIL/assets/js/7.7b446a02.js"><link rel="prefetch" href="/TIL/assets/js/8.7af5714d.js"><link rel="prefetch" href="/TIL/assets/js/9.c42bffae.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.25cf7e1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today kiyeoneee Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/kiyeoneee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://kyeoneee.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Tech Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/kiyeoneee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://kyeoneee.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Tech Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Books</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/TIL/book/clean-code" class="sidebar-heading clickable open"><span>Clean Code</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/book/clean-code/2-의미있는-이름.html" class="sidebar-link">2장. 의미있는 이름</a></li><li><a href="/TIL/book/clean-code/3-함수.html" class="sidebar-link">3장. 함수</a></li><li><a href="/TIL/book/clean-code/4-주석.html" class="sidebar-link">4장. 주석</a></li><li><a href="/TIL/book/clean-code/5-형식-맞추기.html" class="sidebar-link">5장. 형식 맞추기</a></li><li><a href="/TIL/book/clean-code/6-객체와-자료-구조.html" class="sidebar-link">6장. 객체와 자료 구조</a></li><li><a href="/TIL/book/clean-code/7-오류-처리.html" class="sidebar-link">7장. 오류 처리</a></li><li><a href="/TIL/book/clean-code/8-경계.html" class="sidebar-link">8장. 경계</a></li><li><a href="/TIL/book/clean-code/9-단위테스트.html" class="sidebar-link">9장. 단위 테스트</a></li><li><a href="/TIL/book/clean-code/10-클래스.html" class="sidebar-link">10장. 클래스</a></li><li><a href="/TIL/book/clean-code/11-시스템.html" class="sidebar-link">11장. 시스템</a></li><li><a href="/TIL/book/clean-code/12-창발성.html" class="sidebar-link">12장. 창발성</a></li><li><a href="/TIL/book/clean-code/14-점진적-개선.html" class="sidebar-link">14장. 점진적 개선</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx를-이용해-springboot-application을-80-port로-프록시"><a href="#nginx를-이용해-springboot-application을-80-port로-프록시" class="header-anchor">#</a> Nginx를 이용해 SpringBoot Application을 80 port로 프록시</h1> <p>SpringBoot Application을 80 port로 사용하고 싶은데, 리눅스 환경에서 80, 443과 같은 포트는 루트 권한으로 사용이 가능하다.<br>
SpringBoot application의 내장 톰켓이 해당 포트를 사용할 수 있도록 sudo 권한을 사용해 서비스를 올리는 것 보다 proxy 서버를 올리는게 더욱 용이하므로 Nginx를 사용한 내용을 정리한다.</p> <br> <h2 id="nginx-란"><a href="#nginx-란" class="header-anchor">#</a> Nginx 란?</h2> <p>Apache의 1만명 규모 클라이언트의 동시 접속을 다루는 기술적인 이슈를 해결하기 위해 만든 Event-driven 구조의 오픈소스 서버 프로그램이다.
일반적인 HTTP 웹서버의 역할 외에도 proxy, reverse proxy를 제공한다.</p> <br> <h2 id="설치-및-설정"><a href="#설치-및-설정" class="header-anchor">#</a> 설치 및 설정</h2> <h3 id="centos6"><a href="#centos6" class="header-anchor">#</a> Centos6</h3> <p>서버의 권한 이슈로 sudo 명령어를 사용</p> <h4 id="설치"><a href="#설치" class="header-anchor">#</a> 설치</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>$  <span class="token function">sudo</span> yum <span class="token function">install</span> nginx
</code></pre></div><br> <h4 id="라우팅-설정"><a href="#라우팅-설정" class="header-anchor">#</a> 라우팅 설정</h4> <p>yum으로 nginx를 설치하게 되면 <code>/etc/nginx</code> 경로에 설치된다.<br>
nginx 디렉토리 중 <code>conf.d</code>디렉토리 하위의 <code>default.conf</code> 파일을 변경하여 SpringBoot Application을 80 port로 포팅 한다.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vi</span> /etc/nginx/conf.d/default.conf
<span class="token comment"># 아래와 같이 변경</span>
<span class="token comment"># The default server</span>
<span class="token comment">#</span>

server <span class="token punctuation">{</span>
<span class="token comment">#    listen       80 default_server; </span>
<span class="token comment">#    listen       [::]:80 default_server;</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  _<span class="token punctuation">;</span>
    root         /usr/share/nginx/html<span class="token punctuation">;</span>

    <span class="token comment"># Load configuration files for the default server block.</span>
    include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
<span class="token comment">#				SpringBoot application을 매핑</span>
        proxy_pass http://localhost:9100<span class="token punctuation">;</span>
<span class="token comment">#				java application은 requestUrl을 실제 client가 조회하는 url로 받기 위한 설정</span>
        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /40x.html <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h5 id="server-블럭"><a href="#server-블럭" class="header-anchor">#</a> <strong>server 블럭</strong></h5> <p>도메인 단위의 1차 라우팅에 대한 설정을 담당한다..</p> <ul><li>listen : 서버 블록 정의 중 해당 서버에서 라우팅 할 특정 port를 정의하는 필드
<ul><li>default_server : 여러개의 server 블록을 작성할 때 default_server는 프로토콜 별로 단 하나의 server 블록에만 존재해야 합니다. 이 설정은 별도로 지정하지 않은 도메인으로 들어오는 다른 모든 요청에 대해서 해당 server 블록이 처리함을 의미한다.</li></ul></li> <li>server_name : 어떤 도메인을 라우팅 할지에 대한 필드</li></ul> <br> <h5 id="location-블럭"><a href="#location-블럭" class="header-anchor">#</a> location 블럭</h5> <p>URI 리퀘스트의 path prefix의 매칭을 확인하여 적절한 어플리케이션으로 매핑한다.</p> <ul><li>proxy_pass : 실질적으로 요청 할 서비스를 명시하는 필드</li></ul> <br> <h4 id="nginx-실행"><a href="#nginx-실행" class="header-anchor">#</a> Nginx 실행</h4> <p>아래의 명령어로 nginx 명령어 만으로 실행이 완료되고 별다른 알람 없이 실행이 완료되면 ps 명령어로 한번 더 확인 해 준다.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">sudo</span> nginx
$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx
root     <span class="token number">20270</span>     <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:36 ?        00:00:00 nginx: master process nginx
nginx    <span class="token number">20271</span> <span class="token number">20270</span>  <span class="token number">0</span> <span class="token number">16</span>:36 ?        00:00:01 nginx: worker process
nginx    <span class="token number">20272</span> <span class="token number">20270</span>  <span class="token number">0</span> <span class="token number">16</span>:36 ?        00:00:01 nginx: worker process
nginx    <span class="token number">20273</span> <span class="token number">20270</span>  <span class="token number">0</span> <span class="token number">16</span>:36 ?        00:00:01 nginx: worker process
</code></pre></div><br> <h4 id="nginx-기타-운영"><a href="#nginx-기타-운영" class="header-anchor">#</a> Nginx 기타 운영</h4> <h5 id="nginx-중지"><a href="#nginx-중지" class="header-anchor">#</a> Nginx 중지</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>$ nginx -s stop
</code></pre></div><h5 id="nginx-리로드"><a href="#nginx-리로드" class="header-anchor">#</a> Nginx 리로드</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>$ nginx -s reload
</code></pre></div><h5 id="nginx-체크"><a href="#nginx-체크" class="header-anchor">#</a> Nginx 체크</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>$ nginx -s check
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.36d7193a.js" defer></script><script src="/TIL/assets/js/2.58d7ab3e.js" defer></script><script src="/TIL/assets/js/41.af98162f.js" defer></script>
  </body>
</html>
